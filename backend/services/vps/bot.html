<!DOCTYPE html>
<html>
<head>
  <title>Zoom Bot</title>
  <meta charset="utf-8" />
  <!-- Zoom SDK vendor libs -->
  <script src="https://source.zoom.us/2.18.0/lib/vendor/react.min.js"></script>
  <script src="https://source.zoom.us/2.18.0/lib/vendor/react-dom.min.js"></script>
  <script src="https://source.zoom.us/2.18.0/lib/vendor/redux.min.js"></script>
  <script src="https://source.zoom.us/2.18.0/lib/vendor/redux-thunk.min.js"></script>
  <script src="https://source.zoom.us/2.18.0/lib/vendor/lodash.min.js"></script>
  <!-- Zoom SDK -->
  <script src="https://source.zoom.us/2.18.0/zoom-meeting-2.18.0.min.js"></script>
</head>
<body>
  <div id="zmmtg-root"></div>
  <div id="aria-notify-area"></div>
  <div id="status">Loading Zoom SDK...</div>

  <script>
    // Extract parameters from URL
    const urlParams = new URLSearchParams(window.location.search);
    const meetingNumber = urlParams.get("meetingId");
    const password = urlParams.get("password") || "";
    const signature = urlParams.get("signature");
    const sdkKey = urlParams.get("sdkKey");
    const userName = "BotUser";

    if (!meetingNumber || !signature || !sdkKey) {
      document.getElementById('status').textContent = "Missing required parameters.";
      console.error("Missing required URL params.");
      throw new Error("Missing required parameters");
    }

    // Set Zoom SDK lib location
    ZoomMtg.setZoomJSLib("https://source.zoom.us/2.18.0/lib", "/av");
    ZoomMtg.preLoadWasm();
    ZoomMtg.prepareJssdk();

    // Zoom init + join with detailed logging
    ZoomMtg.init({
      leaveUrl: "about:blank",
      success: () => {
        console.log("Zoom SDK initialized.");
        document.getElementById('status').textContent = "Zoom SDK initialized. Joining meeting...";
        ZoomMtg.join({
          meetingNumber,
          userName,
          sdkKey,
          signature,
          passWord: password,
          success: () => {
            console.log("Joined meeting successfully!");
            document.getElementById('status').textContent = "Joined meeting!";
          },
          error: (err) => {
            console.error("Join error:", err);
            document.getElementById('status').textContent = "Join error: " + JSON.stringify(err);
          },
        });
      },
      error: (err) => {
        console.error("Init error:", err);
        document.getElementById('status').textContent = "Init error: " + JSON.stringify(err);
      }
    });
  </script>
</body>
</html>
